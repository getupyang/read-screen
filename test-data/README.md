# ğŸ“Š æµ‹è¯•æ•°æ®ç®¡ç†è§„èŒƒ

## è®¾è®¡ç†å¿µ

å‚è€ƒä¸šç•Œæœ€ä½³å®è·µï¼ˆOpenAI Evalsã€HuggingFace Datasetsã€MLflowï¼‰ï¼š

1. **ç»“æ„åŒ–å­˜å‚¨** - JSON Linesæ ¼å¼ï¼Œæ˜“äºè¿½åŠ å’ŒæŸ¥è¯¢
2. **ç‰ˆæœ¬æ§åˆ¶** - Gitç®¡ç†ï¼Œå¯è¿½æº¯å†å²
3. **å…ƒæ•°æ®å®Œæ•´** - åŒ…å«ä¸Šä¸‹æ–‡ã€æœŸæœ›ã€å®é™…è¾“å‡º
4. **æ˜“äºæ‰©å±•** - æ”¯æŒæ–°å¢å­—æ®µå’Œè¯„æµ‹ç»´åº¦

---

## æ•°æ®æ ¼å¼å®šä¹‰

### æµ‹è¯•æ¡ˆä¾‹ï¼ˆTest Caseï¼‰

```jsonl
{
  "id": "case_001",
  "version": "v1.0",
  "created_at": "2025-12-04T10:30:00Z",
  "created_by": "user_getupyang",

  // å›¾ç‰‡ä¿¡æ¯
  "image": {
    "filename": "1764815020083-24wcg.jpg",
    "supabase_url": "https://...",
    "upload_time": "2025-12-04T10:29:00Z",
    "source_platform": "å°çº¢ä¹¦"
  },

  // ç”¨æˆ·åœºæ™¯ï¼ˆUser Contextï¼‰
  "user_context": {
    "scenario": "åˆ·å°çº¢ä¹¦æ—¶çœ‹åˆ°åšä¸»ä»‹ç»Anthropicæ–°æŠ¥å‘Š",
    "user_state": "å¯¹æŠ¥å‘Šå†…å®¹æ„Ÿå…´è¶£ï¼Œæƒ³äº†è§£ä½†æ‡’å¾—æœ",
    "original_behavior": "é€šå¸¸éœ€è¦ï¼š1) æœæŠ¥å‘Šåå­— 2) æ‰¾æŠ¥å‘Šå†…å®¹ 3) é˜…è¯»å…¨æ–‡",
    "pain_points": [
      "éœ€è¦è‡ªå·±å»æœç´¢",
      "å¯èƒ½è¡ŒåŠ¨åŠ›ä¸å¼ºï¼Œä¸ä¼šçœŸçš„å»çœ‹",
      "å…¨æ–‡å¤ªé•¿ï¼Œåªæƒ³çœ‹ç²¾å"
    ]
  },

  // ç”¨æˆ·éœ€æ±‚ï¼ˆUser Needsï¼‰
  "user_needs": {
    "primary": "ä¸éœ€è¦è‡ªå·±å»æœï¼Œè‡ªåŠ¨æä¾›æŠ¥å‘ŠåŸºæœ¬ä¿¡æ¯",
    "secondary": "æå–æŠ¥å‘Šä¸­çš„å…³é”®ç‚¹ã€æœ‰å¯å‘çš„è¯",
    "tertiary": "å¡ç‰‡å½¢å¼å±•ç°ï¼Œæ–¹ä¾¿é˜…è¯»",
    "explicitly_stated": [
      "æŠ¥å‘Šå«ä»€ä¹ˆåå­—",
      "æŠ¥å‘Šè®²ä»€ä¹ˆå†…å®¹",
      "è®ºæ–‡ä¸­ä¸€ä¸¤å¥æœ‰å¯å‘çš„è¯"
    ],
    "implicitly_inferred": [
      "ä¸ºä»€ä¹ˆè¿™ä¸ªæŠ¥å‘Šé‡è¦",
      "Anthropicå¦‚ä½•ä½¿ç”¨AIï¼ˆå…·ä½“æ¡ˆä¾‹ï¼‰",
      "å¯¹æˆ‘æœ‰ä»€ä¹ˆå¯å‘"
    ]
  },

  // ç”¨æˆ·æœŸæœ›ï¼ˆUser Expectationsï¼‰
  "user_expectations": {
    "information_completeness": "ä¸éœ€è¦å…¨æ–‡æ€»ç»“ï¼Œåªè¦ç²¾å",
    "presentation_style": "å¡ç‰‡å½¢å¼ï¼Œå¹²å‡€æ•´æ´ï¼Œæœ‰é˜…è¯»æ¬²æœ›ä½†æ— å‹åŠ›",
    "fragmentation_level": "ä¸è¿‡äºç¢ç‰‡åŒ–ï¼Œä¸€å¼ å¡ç‰‡è®²æ¸…æ¥šä¸€ä¸ªç‚¹",
    "incremental_value": "å¿…é¡»æä¾›æˆªå›¾ä¸­æ²¡æœ‰çš„ä¿¡æ¯ï¼ˆæŠ¥å‘Šåã€å†…å®¹ã€é‡‘å¥ï¼‰"
  },

  // å‚è€ƒç­”æ¡ˆï¼ˆGround Truth - å¯é€‰ï¼‰
  "ground_truth": {
    "expected_cards": [
      {
        "title": "Anthropicå†…éƒ¨AIä½¿ç”¨æŠ¥å‘Š",
        "key_points": [
          "æŠ¥å‘Šåç§°",
          "å‘å¸ƒæ—¶é—´",
          "æ ¸å¿ƒè§‚ç‚¹1",
          "æ ¸å¿ƒè§‚ç‚¹2"
        ],
        "golden_quotes": ["æŠ¥å‘Šä¸­çš„é‡‘å¥1", "æŠ¥å‘Šä¸­çš„é‡‘å¥2"]
      }
    ],
    "must_have_elements": [
      "æŠ¥å‘Šçš„å‡†ç¡®åç§°",
      "å‘å¸ƒæ—¶é—´",
      "è‡³å°‘2-3ä¸ªå…³é”®æ´å¯Ÿ",
      "è‡³å°‘1-2å¥åŸæ–‡å¼•ç”¨"
    ]
  },

  // æ ‡ç­¾ï¼ˆç”¨äºåˆ†ç±»å’Œæ£€ç´¢ï¼‰
  "tags": [
    "æ¨èç±»",
    "æŠ¥å‘Š/è®ºæ–‡",
    "Anthropic",
    "AIåº”ç”¨",
    "å°çº¢ä¹¦"
  ],

  // éš¾åº¦ç­‰çº§
  "difficulty": "medium",
  "difficulty_reason": "éœ€è¦è”ç½‘æŸ¥æ‰¾æŠ¥å‘Šä¿¡æ¯ï¼Œä¸èƒ½ä»…é æˆªå›¾"
}
```

### æµ‹è¯•ç»“æœï¼ˆTest Resultï¼‰

```jsonl
{
  "test_id": "test_20251204_001",
  "case_id": "case_001",
  "prompt_version": "v1.0_simplified",
  "model": "gemini-2.5-flash",
  "tested_at": "2025-12-04T10:35:00Z",

  // AIå®é™…è¾“å‡º
  "ai_output": {
    "cards": [
      {
        "type": "CONCEPT",
        "title": "...",
        "content": "..."
      }
    ],
    "raw_response": "å®Œæ•´çš„JSONå“åº”"
  },

  // LLMè¯„åˆ¤ç»“æœ
  "llm_judge_evaluation": {
    "scores": {
      "need_prediction": 8,
      "need_fulfillment": 7,
      "presentation": 9,
      "total": 24
    },
    "analysis": {
      "need_prediction_check": "æ˜¯å¦è¯†åˆ«å‡ºç”¨æˆ·æƒ³äº†è§£æŠ¥å‘Šä¿¡æ¯",
      "need_fulfillment_check": "æ˜¯å¦æä¾›äº†æŠ¥å‘Šåç§°ã€å†…å®¹ã€é‡‘å¥",
      "presentation_check": "å¡ç‰‡æ˜¯å¦å¹²å‡€æ•´æ´ã€æ˜“è¯»",
      "strengths": ["..."],
      "weaknesses": ["..."]
    }
  },

  // äººå·¥è¯„åˆ¤ç»“æœï¼ˆå¯é€‰ï¼Œç”¨äºæ ¡å‡†LLMè¯„åˆ¤ï¼‰
  "human_evaluation": {
    "scores": {
      "need_prediction": 9,
      "need_fulfillment": 6,
      "presentation": 8,
      "total": 23
    },
    "comments": "äººå·¥è¯„è¯­",
    "calibration_diff": "ä¸LLMè¯„åˆ¤çš„å·®å¼‚åˆ†æ"
  },

  // æ˜¯å¦é€šè¿‡
  "passed": false,
  "verdict": "éœ€è¦æ”¹è¿›",

  // æ”¹è¿›å»ºè®®
  "improvement_suggestions": [
    "éœ€è¦è¡¥å……æŠ¥å‘Šçš„å‡†ç¡®åç§°",
    "åº”è¯¥æä¾›å‘å¸ƒæ—¶é—´",
    "é‡‘å¥å¼•ç”¨ä¸å¤Ÿ"
  ]
}
```

---

## æ–‡ä»¶ç»„ç»‡ç»“æ„

```
/test-data/
â”œâ”€â”€ cases/                    # æµ‹è¯•æ¡ˆä¾‹
â”‚   â”œâ”€â”€ 001_anthropic_report.jsonl
â”‚   â”œâ”€â”€ 002_kevin_weil_builders.jsonl
â”‚   â”œâ”€â”€ 003_year_sociology.jsonl
â”‚   â””â”€â”€ ...
â”œâ”€â”€ results/                  # æµ‹è¯•ç»“æœ
â”‚   â”œâ”€â”€ v1.0_simplified/
â”‚   â”‚   â”œâ”€â”€ 20251204_run1.jsonl
â”‚   â”‚   â””â”€â”€ summary.json
â”‚   â”œâ”€â”€ v2.0_enhanced/
â”‚   â”‚   â”œâ”€â”€ 20251204_run1.jsonl
â”‚   â”‚   â””â”€â”€ summary.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ground-truth/            # äººå·¥æ ‡æ³¨çš„å‚è€ƒç­”æ¡ˆï¼ˆé‡‘æ ‡å‡†ï¼‰
â”‚   â”œâ”€â”€ 001_anthropic_report_gt.json
â”‚   â””â”€â”€ ...
â””â”€â”€ metadata.json            # å…ƒæ•°æ®ï¼šç‰ˆæœ¬å†å²ã€ç»Ÿè®¡ä¿¡æ¯
```

---

## æ•°æ®ç®¡ç†å·¥å…·

### 1. æ·»åŠ æµ‹è¯•æ¡ˆä¾‹

```bash
npm run data:add-case
```

äº¤äº’å¼è¾“å…¥ï¼š
- å›¾ç‰‡æ–‡ä»¶å
- ç”¨æˆ·åœºæ™¯æè¿°
- ç”¨æˆ·éœ€æ±‚
- æœŸæœ›è¾“å‡º

è‡ªåŠ¨ç”Ÿæˆæ ‡å‡†åŒ–JSONã€‚

### 2. è¿è¡Œè¯„æµ‹

```bash
npm run data:evaluate --prompt-version v2.0
```

- è¯»å–æ‰€æœ‰æµ‹è¯•æ¡ˆä¾‹
- è¿è¡ŒAIåˆ†æ
- LLMè¯„åˆ¤
- ä¿å­˜ç»“æœåˆ° `results/v2.0/`

### 3. å¯¹æ¯”ç‰ˆæœ¬

```bash
npm run data:compare v1.0 v2.0
```

è¾“å‡ºï¼š
```
ç‰ˆæœ¬å¯¹æ¯”æŠ¥å‘Š
====================
v1.0_simplified vs. v2.0_enhanced

é€šè¿‡ç‡:  60% â†’ 85% (+25%)
å¹³å‡åˆ†:  18.5 â†’ 23.2 (+4.7)

æ”¹è¿›æœ€å¤šçš„æ¡ˆä¾‹:
- case_001: 15åˆ† â†’ 24åˆ† (+9åˆ†)
- case_003: 20åˆ† â†’ 26åˆ† (+6åˆ†)

ä»éœ€æ”¹è¿›çš„æ¡ˆä¾‹:
- case_005: 12åˆ† â†’ 14åˆ† (ä»…+2åˆ†)
```

### 4. å¯¼å‡ºæ•°æ®é›†

```bash
npm run data:export --format huggingface
```

å¯¼å‡ºä¸ºHuggingFace Datasetæ ¼å¼ï¼Œæ–¹ä¾¿æœªæ¥å¾®è°ƒæˆ–å…¬å¼€åˆ†äº«ã€‚

---

## æ•°æ®ç”Ÿå‘½å‘¨æœŸ

```
1. ç”¨æˆ·åé¦ˆ â†’ åˆ›å»ºæµ‹è¯•æ¡ˆä¾‹
   â†“
2. æ·»åŠ åˆ° cases/ ç›®å½•
   â†“
3. Git commitï¼ˆç‰ˆæœ¬æ§åˆ¶ï¼‰
   â†“
4. è¿è¡Œè¯„æµ‹ â†’ ç”Ÿæˆç»“æœ
   â†“
5. ç»“æœå­˜å…¥ results/
   â†“
6. äººå·¥æŠ½æ ·æ ¡å‡†ï¼ˆå¯é€‰ï¼‰
   â†“
7. è¿­ä»£ä¼˜åŒ– â†’ æ–°Promptç‰ˆæœ¬
   â†“
8. é‡å¤æ­¥éª¤4-7
```

---

## è´¨é‡ä¿è¯

### 1. æµ‹è¯•æ¡ˆä¾‹è´¨é‡æ£€æŸ¥

æ¯ä¸ªæ¡ˆä¾‹å¿…é¡»åŒ…å«ï¼š
- âœ… æ¸…æ™°çš„ç”¨æˆ·åœºæ™¯
- âœ… æ˜ç¡®çš„ç”¨æˆ·éœ€æ±‚
- âœ… åˆç†çš„æœŸæœ›è¾“å‡º
- âœ… è‡³å°‘3ä¸ªæ ‡ç­¾

### 2. è¦†ç›–ç‡æ£€æŸ¥

ç¡®ä¿æµ‹è¯•æ¡ˆä¾‹è¦†ç›–ï¼š
- [ ] æ¨èç±»ï¼ˆäººç‰©/å·¥å…·/è®ºæ–‡ï¼‰
- [ ] æ¦‚å¿µè§£é‡Šç±»
- [ ] è§‚ç‚¹åˆ†äº«ç±»
- [ ] å¤šç§æ¥æºå¹³å°ï¼ˆå°çº¢ä¹¦/å¾®ä¿¡/çŸ¥ä¹ï¼‰
- [ ] ä¸åŒéš¾åº¦ç­‰çº§ï¼ˆeasy/medium/hardï¼‰

### 3. å®šæœŸå®¡æŸ¥

- æ¯å‘¨å®¡æŸ¥ä¸€æ¬¡æµ‹è¯•ç»“æœ
- æ¯æœˆæ›´æ–°ä¸€æ¬¡æµ‹è¯•æ¡ˆä¾‹
- æ·˜æ±°è¿‡æ—¶æˆ–ä½è´¨é‡æ¡ˆä¾‹

---

## ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

### 1. ä¸è¯„æµ‹è„šæœ¬é›†æˆ

`scripts/evaluate-prompt.ts` è¯»å– `test-data/cases/` ä¸­çš„æ¡ˆä¾‹ã€‚

### 2. ä¸Supabaseé›†æˆ

è‡ªåŠ¨ä»Supabaseæ‹‰å–æ–°ä¸Šä¼ çš„å›¾ç‰‡ï¼Œç”Ÿæˆæµ‹è¯•æ¡ˆä¾‹è‰ç¨¿ã€‚

### 3. ä¸CI/CDé›†æˆ

æ¯æ¬¡Promptæ›´æ–°æ—¶ï¼Œè‡ªåŠ¨è¿è¡Œè¯„æµ‹ï¼Œç”Ÿæˆå¯¹æ¯”æŠ¥å‘Šã€‚

---

## å‚è€ƒèµ„æ–™

- [OpenAI Evals](https://github.com/openai/evals)
- [HuggingFace Datasets](https://huggingface.co/docs/datasets)
- [MLflow](https://mlflow.org/)
- [Evidently AI](https://www.evidentlyai.com/)
